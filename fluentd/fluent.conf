<source>
	type forward
	port 24224
	bind 0.0.0.0
</source>
<source>
	type http
	port 8888
	bind 0.0.0.0
</source>

<match docker.**>
       type map
       map ( record["commits"].map {| commit | ["mapped."+tag, time, commit.merge(record)]})
       multi true
</match>

<match mapped.docker.**>
       type exec_filter
       command ruby /fluentd/etc/commit.rb
       in_format json
       out_format json
       tag api.mapped.docker.gitlab
#       buffer_type file # デフォルトでfileになっている
#       buffer_path /tmp/test
       flush_interval 1s
</match>

<match api.mapped.docker.gitlab.**>
       type copy
       <store>
       type elasticsearch
       log_level debug
       host elasticsearch
       port 9200
       include_tag_key true
       logstash_format true
       flush_interval 5s
       </store>
       <store>
       type stdout
       </store>
</match>